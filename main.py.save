from flask import Flask, render_template
from gpiozero import LED, Button, DistanceSensor
import sys

app = Flask(__name__)

lightled = LED(21)
lightbutton = Button(6)
lightstatus = False
distancesensor = DistanceSensor(echo=22,trigger=27)

while True:
	print(distancesensor.distance*100, file=sys.stderr)


def updatelightstatus():
	global lightstatus
	status = ""
	if lightstatus:
		lightstatus = False
		status = "off"
	else:
		lightstatus = True
		status = "on"
	return status

def buttonpress():
	print("buttonpressed", file=sys.stderr)
	status = updatelightstatus()
	
	light_state(status)


lightbutton.when_pressed =  buttonpress

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/Light/<state>')
def light_state(state):
	if state == 'on':
		lightled.on()
		message = "LED is on"
	elif state == 'off':
		lightled.off()
		message = "Led is off"
	else:
		message = "Invalid State"
	return render_template('index.html', message=message)

if __name__=="__main__":
	while True:
    		try:
        		if __name__ == "__main__":
            			app.run(host='0.0.0.0', port=80)
    		except KeyboardInterrupt: #clean up GPIO
        		print("Ending program")
